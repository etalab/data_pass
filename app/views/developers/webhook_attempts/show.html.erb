<% content_for :content_skip_link_text do %>
  DÃ©tails de l'appel
<% end %>

<% content_for :skip_links do %>
  <%= skip_link("Informations", "call-details") %>
  <%= skip_link("Menu", "header") %>
  <%= skip_link("Pied de page", "footer") %>
<% end %>

<div class="sub-header">
  <div>
    <h1 class="fr-m-0"><%= t('.title') %></h1>
  </div>

  <div>
    <%= button_to t('.replay'), replay_developers_webhook_webhook_attempt_path(@webhook, @webhook_attempt), method: :post, class: %w[fr-btn] %>
  </div>
</div>

<div class="fr-mt-4w">
  <%= link_to t('.back'), developers_webhook_webhook_attempts_path(@webhook), class: %w[fr-link fr-icon-arrow-left-line fr-link--icon-left] %>
</div>

<div class="fr-grid-row fr-grid-row--gutters fr-mt-4w" id="call-details">
  <div class="fr-col-12 fr-col-md-6">
    <div class="fr-card fr-card--grey fr-card--no-border">
      <div class="fr-card__body">
        <div class="fr-card__content">
          <p class="fr-card__title"><%= t('.event') %></p>

          <p class="fr-card__desc">
            <span class="fr-badge fr-badge--sm">
              <%= t("webhooks.events.#{@webhook_attempt.event_name}", default: @webhook_attempt.event_name) %>
            </span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="fr-col-12 fr-col-md-6">
    <div class="fr-card fr-card--grey fr-card--no-border">
      <div class="fr-card__body">
        <div class="fr-card__content">
          <p class="fr-card__title"><%= t('.date') %></p>

          <p class="fr-card__desc">
            <%= l(@webhook_attempt.created_at, format: :long) %>
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="fr-col-12 fr-col-md-6">
    <div class="fr-card fr-card--grey fr-card--no-border">
      <div class="fr-card__body">
        <div class="fr-card__content">
          <p class="fr-card__title"><%= t('.status') %></p>

          <p class="fr-card__desc">
            <% if @webhook_attempt.status_code %>
              <span class="fr-badge <%= @webhook_attempt.success? ? 'fr-badge--success' : 'fr-badge--error' %>">
                <%= @webhook_attempt.status_code %>
              </span>
            <% else %>
              <span class="fr-badge fr-badge--error">
                <%= t('.no_response') %>
              </span>
            <% end %>
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="fr-col-12 fr-col-md-6">
    <div class="fr-card fr-card--grey fr-card--no-border">
      <div class="fr-card__body">
        <div class="fr-card__content">
          <p class="fr-card__title"><%= t('.result') %></p>

          <p class="fr-card__desc">
            <% if @webhook_attempt.success? %>
              <span class="fr-badge fr-badge--success">
                <%= t('.success') %>
              </span>
            <% else %>
              <span class="fr-badge fr-badge--error"><%= t('.failure') %></span>
            <% end %>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="fr-mt-6w">
  <h2 class="fr-h3"><%= t('.payload') %></h2>

  <div class="fr-highlight">
    <pre><code><%= JSON.pretty_generate(@webhook_attempt.payload) %></code></pre>
  </div>
</div>

<div class="fr-mt-6w">
  <h2 class="fr-h3"><%= t('.response') %></h2>

  <div class="fr-highlight">
    <pre><code><%= @webhook_attempt.response_body %></code></pre>
  </div>
</div>
