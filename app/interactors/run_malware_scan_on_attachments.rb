class RunMalwareScanOnAttachments < ApplicationInteractor
  def call
    attachment_names.each do |attachment_name|
      attachment = context.authorization_request.public_send(attachment_name.name)
      next if attachment.blank?

      Array(attachment).each do |attached|
        MalwareScanJob.perform_later(attached.id)
      end
    end
  end

  private

  def attachment_names
    context.authorization_request.form.authorization_request_class.documents
  end
end
