<%= render 'shared/dashboard_skip_links' %>

<div class="fr-container">
  <div class="dashboard-sub-header">
    <div class="sub-header">
      <div>
        <h1 class="fr-m-0">
          <%= t('.title') %>
        </h1>

        <%= current_organization.name %> <%= link_to "Changer d'organisation", user_organizations_path, class: %w[fr-btn fr-btn--tertiary fr-btn--sm fr-btn--icon-left fr-icon-hotel-line] %>
      </div>
    </div>
  </div>

  <div class="fr-tabs fr-pt-5w fr-mb-8w" data-controller="auto-height">
    <ul class="fr-tabs__list" role="tablist" aria-label="Menu secondaire">
      <% @tabs.each do |tab| %>
        <li role="presentation">
          <%=
            link_to t(".tabs.#{tab.id}.title"),
              tab.path,
              class: [
                'fr-tabs__tab',
              ],
              role: 'tab',
              id: "tab-#{tab.id}",
              tabindex: current_page?(tab.path) ? '0' : '-1',
              data: {
                turbo_frame: "tab-#{tab.id}-panel",
              },
              aria: {
                selected: current_page?(tab.path),
                controls: "tab-#{tab.id}-panel"
              }
          %>
        </li>
      <% end %>
    </ul>

    <% @tabs.each do |tab| %>
      <turbo-frame id="tab-<%= tab.id %>-panel" class="fr-tabs__panel fr-tabs__panel--selected" role="tabpanel" aria-labelledby="tab-<%= tab.id %>" tabindex="0" data-turbo-action="advance">

        <% if params[:id] == tab.id %>
          <% if @facade.show_filters? %>
            <div class="fr-mb-5w">
              <%= render 'search_form' %>
            </div>
          <% end %>

          <% if @facade.show_organization_verification_warning? %>
            <div class="fr-alert fr-alert--warning fr-mb-6w">
              Votre lien avec l'organisation <strong><%= current_organization.name %></strong> (SIRET: <%= current_organization.siret %>) n'est pas vérifié, vous ne pouvez accéder ou consulter les autres demandes ou habilitations de cette organisation.
            </div>
          <% end %>

          <div data-auto-height-target="source">
            <turbo-frame id="<%= "#{params[:id]}-table" %>" class="search-results-container">
              <% @facade.data[:highlighted_categories].each do |category, items| %>
                <% next if items.empty? %>
                <%= render partial: 'highlighted_list', locals: { items: items.decorate, kind: category } %>
              <% end %>
              <% @facade.data[:categories].each do |category, items| %>
                <% next if items.empty? %>
                <%= render partial: 'list', locals: { items: items.decorate, kind: category } %>
              <% end %>
            </turbo-frame>
          </div>
        <% else %>
          <div data-auto-height-target="destination">
          </div>
        <% end %>
      </turbo-frame>
    <% end %>
  </div>
</div>
