<%= search_form_for(search_engine, url: dashboard_show_path(id: params[:id]), html: { method: :get, data: { controller: 'auto-submit-form', 'auto-submit-form-debounce-interval-value' => 500, 'auto-submit-form-event-mode-value' => 'input', turbo_frame: "tab-#{params[:id]}-panel" }, class: %w[search-box] }) do |f| %>
  <div class="search-inputs">
    <div class="fr-input-group main-input input">
      <%= f.label :within_data_or_id_cont, t('dashboard.show.search.main_input.label_demandes'), class: %w[fr-label] %>
      <%= f.search_field :within_data_or_id_cont, class: %w[fr-input], placeholder: t('dashboard.show.search.main_input.placeholder_demandes') %>
    </div>

    <div class="fr-select-group input">
      <%= f.label :state_eq, t('dashboard.show.search.status.label'), class: %w[fr-label], for: 'demandes_state_filter' %>
      <%= f.select :state_eq,
                   options_for_select([
                                        [t('dashboard.show.search.status.options.all'), ''],
                                        [t('dashboard.show.search.status.options.draft'), 'draft'],
                                        [t('dashboard.show.search.status.options.changes_requested'), 'changes_requested'],
                                        [t('dashboard.show.search.status.options.pending'), 'submitted'],
                                        [t('dashboard.show.search.status.options.refused'), 'refused']
                                      ], selected: params[:search_query]&.dig(:state_eq)),
                   {},
                   class: %w[fr-select],
                   id: 'demandes_state_filter'
      %>
    </div>

    <div class="fr-select-group input">
      <%= f.label :user_relationship_eq, t('dashboard.show.search.user_relationship.label'), class: %w[fr-label], for: 'user_relationship_filter' %>
      <%= f.select :user_relationship_eq,
                   options_for_select([
                                        [t('dashboard.show.search.user_relationship.options.applicant'), 'applicant'],
                                        [t('dashboard.show.search.user_relationship.options.contact'), 'contact'],
                                        [t('dashboard.show.search.user_relationship.options.organization'), 'organization']
                                      ], selected: params[:search_query]&.dig(:user_relationship_eq) || 'applicant'),
                   {},
                   class: %w[fr-select],
                   id: 'user_relationship_filter'
      %>
    </div>
  </div>

  <div class="actions">
    <%= f.button t('dashboard.show.search.btn'), type: :submit, class: %w[fr-btn fr-btn--primary] %>
    <%= link_to t('dashboard.show.search.reset'), dashboard_show_path(id: params[:id]), class: %w[fr-btn fr-btn--secondary] %>
  </div>
<% end %>

<div data-auto-height-target="source">
  <% @facade.highlighted_categories.each do |category, items| %>
    <% next if items.empty? %>
    <div class="fr-grid-row fr-grid-row--gutters fr-background-contrast--info fr-px-4v fr-mb-4w">
      <div class="fr-col-12">
        <h2 class="fr-h3 with-icon fr-mt-8w fr-mb-0 dashboard-title__panel fr-text-title--blue-france">
          <%= t("dashboard.show.lists.#{category}_title") %>
        </h2>
      </div>

      <% items.each do |item| %>
        <div class="fr-col-12">
          <%= render item.decorate, authorization_request: item.decorate %>
        </div>
      <% end %>
    </div>
  <% end %>

  <% @facade.categories.each do |category, items| %>
    <% next if items.empty? %>
    <div class="fr-grid-row fr-grid-row--gutters fr-mb-4w">
      <div class="fr-col-12">
        <h2 class="fr-h3 with-icon fr-mt-8w fr-mb-0 dashboard-title__panel fr-text-title--blue-france">
          <%= t("dashboard.show.lists.#{category}_title") %>
        </h2>
      </div>

      <% items.each do |item| %>
        <div class="fr-col-12">
          <%= render item.decorate, authorization_request: item.decorate %>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
