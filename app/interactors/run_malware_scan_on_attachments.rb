class RunMalwareScanOnAttachments < ApplicationInteractor
  def call
    attachment_names.each do |attachment_name|
      attachment = context.authorization_request.send(attachment_name)

      MalwareScanJob.perform_later(attachment.id)
    end
  end

  private

  def attachment_names
    authorization_request_class.documents
  end

  def authorization_request_class
    authorization_request_form.authorization_request_class
  end

  def authorization_request_form
    context.authorization_request_form ||
      context.authorization_request.form
  end
end
