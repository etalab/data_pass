<%= render partial: 'authorization_requests/build/header' %>

<div class="fr-alert fr-alert--info">
  <h3 class="fr-alert__title">
    Vous allez démarrer une nouvelle demande d'accès pour <%= @authorization_request_form.name %>
  </h3>

  <p>
    Avant de démarrer, quelques points de vigilances:
    <ul>
      <li>
        Vérifiez l'organisation pour laquelle vous allez effectuer cette demande
      </li>
      <li>
        Vérifiez bien que vous êtes éligible pour cette demande
      </li>
    </ul>
  </p>
</div>

<% if current_organization.authorization_requests.where(type: @authorization_request.class.name).any? %>
  <div class="fr-alert fr-alert--warning">
    <h3 class="fr-alert__title">
      L'organization possède déjà une ou plusieurs habilitations en cours pour ce service
    </h3>
    <p>
      Vérifiez que la demande que vous allez démarrez n'ait pas déjà été soumise ou en cours. Voici la liste:
      <ul>
        <% current_organization.authorization_requests.where(type: @authorization_request.class.name).each do |another_authorization_request| %>
          <li>
            <%= link_to another_authorization_request.name, authorization_request_path(form_uid: another_authorization_request.form.uid, id: another_authorization_request.id), target: '_blank' %>
          </li>
        <% end %>
      </ul>
    </p>
  </div>
<% end %>

<%= authorization_request_form(@authorization_request) do |f| %>
  <%= render partial: 'authorization_request_forms/shared/organization', locals: { f: f } %>

  <%= f.submit t('authorization_request_forms.form.start'), name: :start, id: :start_authorization_request, class: %w(fr-btn fr-icon-save-line fr-btn--icon-left) %>
<% end %>
