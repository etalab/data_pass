RSpec.describe RunMalwareScanOnAttachments do
  subject { described_class.call(authorization_request:) }

  let(:authorization_request) { create(:authorization_request, :api_entreprise, :draft) }

  describe '#call' do
    it 'runs a MalwareScanJob for the attachments' do
      expect(MalwareScanJob).to receive(:perform_later).with(authorization_request.maquette_projet.id)
      expect(MalwareScanJob).to receive(:perform_later).with(authorization_request.cadre_juridique_document.id)

      subject
    end
  end
end
