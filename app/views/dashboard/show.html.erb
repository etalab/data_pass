<% set_title! t('page_titles.dashboard') %>

<%= render 'shared/dashboard_skip_links' %>

<div class="dashboard-sub-header">
  <div class="sub-header">
    <div class="sub-header-content">
      <div>
        <h1 class="fr-m-0">
          <%= t('.title') %>
        </h1>

        <div class="sub-header-content__description">
          <p class="fr-mr-1w">
            <%= current_organization.name %>
          </p>
          <%= link_to "Changer d'organisation", user_organizations_path, class: %w[fr-btn fr-btn--tertiary fr-btn--sm fr-btn--icon-left fr-icon-hotel-line], title: "Changer d'organisation - Ouvrir dans une nouvelle fenêtre" %>
        </div>
      </div>
      <div>
        <%= link_to t('dashboard.show.empty_states.common.request_data_access'),
          t('dashboard.show.empty_states.common.dataservices_url'),
          title: "#{t('dashboard.show.empty_states.common.request_data_access')} - Ouvrir dans une nouvelle fenêtre",
          class: 'fr-link fr-link--action-high-blue-france',
          target: '_blank',
          rel: 'noopener noreferrer'
        %>
    </div>
  </div>
</div>

  <div class="fr-tabs fr-pt-5w fr-mb-8w" data-controller="auto-height">
    <ul class="fr-tabs__list" role="tablist" aria-label="Menu secondaire">
      <% @tabs.each do |tab| %>
        <li role="presentation">
          <%=
            link_to t(".tabs.#{tab.id}.title"),
              tab.path,
              class: [
                'fr-tabs__tab',
              ],
              role: 'tab',
              id: "tab-#{tab.id}",
              tabindex: current_page?(tab.path) ? '0' : '-1',
              data: {
                turbo_frame: "tab-#{tab.id}-panel",
              },
              aria: {
                selected: current_page?(tab.path),
                controls: "tab-#{tab.id}-panel"
              }
          %>
        </li>
      <% end %>
    </ul>

  <% @tabs.each do |tab| %>
    <turbo-frame id="tab-<%= tab.id %>-panel" class="fr-tabs__panel <%= 'fr-tabs__panel--selected' if params[:id] == tab.id %>" role="tabpanel" aria-labelledby="tab-<%= tab.id %>" tabindex="0" data-turbo-action="advance" aria-hidden="<%= params[:id] != tab.id %>">

        <% if params[:id] == tab.id %>

          <% if @facade.show_filters? %>
            <div class="fr-mb-5w">
              <%= render 'search_form' %>
            </div>
          <% end %>

          <% if @facade.show_organization_verification_warning? %>
            <div class="fr-alert fr-alert--info fr-mb-6w">
              <p>
                Nous n’avons pas pu vérifier votre lien avec l’organisation que vous avez sélectionnée,
                vous ne pourrez pas consulter l’ensemble des demandes et habilitations de l’organisation.
              </p>
            </div>
          <% end %>

          <div data-auto-height-target="source">
            <turbo-frame id="<%= "#{params[:id]}-table" %>" class="search-results-container">
              <% if @facade.empty_with_filter? %>
                <%= render 'blank_state', component: @facade.no_results_component, action: @facade.no_results_action %>
              <% elsif @facade.empty? %>
                <%= render 'blank_state', component: @facade.empty_state_component, action: @facade.empty_state_action %>
              <% else %>
                <% @facade.highlighted_categories.each do |category, items| %>
                  <% next if items.empty? %>
                  <%= render partial: 'highlighted_list', locals: { items: items.decorate, kind: category } %>
                <% end %>
                <% @facade.categories.each do |category, items| %>
                  <% next if items.empty? %>
                  <%= render partial: 'list', locals: { items: items.decorate, kind: category } %>
                <% end %>
              <% end %>
            </turbo-frame>
          </div>
        <% else %>
          <div data-auto-height-target="destination">
          </div>
        <% end %>
      </turbo-frame>
    <% end %>
  </div>
</div>
